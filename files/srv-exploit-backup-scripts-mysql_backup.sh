#!/bin/bash
LOC="/srv/exploit/backup/"
user=backup
host=127.0.0.1
pass="$(cat ${LOC}scripts/.mysql_backup_pass)"
NOW="$(date +"%a")"
DESTINATION="${LOC}mysqldump/"
BASES="$(mysql -u $user -h $host -p$pass -Bse 'show databases')"

for db in $BASES
do
	FILE=${DESTINATION}${db}.${NOW}.sql.gz
	mysqldump -u $user -h $host -p$pass --single-transaction --compact --order-by-primary --add-drop-table $db -R | gzip -9 > $FILE
done
